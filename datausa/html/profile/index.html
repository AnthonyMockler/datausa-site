{% extends "templates/nav.html" %}

{% block body %}

<script>var builds = [];</script>

<article id="splash">

  <div class="content">

    <div class="thumbprint"></div>

    <h1>{{ profile.splash.title }}</h1>
    <sub>Lorem Ipsum</sub>
    <p class="desc">{{ profile.splash.description }}</p>

    <div id="splash-stats">
      {% for stat in profile.splash.stats %}
      <div class="stat">
        <div class="stat-text">{{ stat.title }}</div>
        <div class="stat-value">{{ stat.value }}</div>
        <div class="stat-rank">Rank: {{ stat.rank }}</div>
      </div>
      {% endfor %}
    </div>

    <div class="carousel">
      <div class="carousel-title">Did you know?</div>
      <div class="carousel-slider">
        {% for fact in profile.splash.facts %}
          <p class="carousel-text{% if loop.index == 1%} active{% endif %}">{{ fact }}</p>
        {% endfor %}
      </div>
      <div class="carousel-btns">
        {% for fact in profile.splash.facts %}
          <div class="carousel-btn{% if loop.index == 1%} active{% endif %}" style="background-color:{{ profile.color() }}"></div>
        {% endfor %}
      </div>
    </div>

    <div id="scroll-btn">
      <i class="fa fa-angle-down"></i>
    </div>

  </div>

</article>

<div id="title-bar" style="background-color: {{ profile.color() }};">
  <h1>{{ profile.attr.name }}</h1>
</div>

{% set sections = profile.sections() %}

<div id="profile-nav">
  <ul>
  {% for section in sections %}
    <a href="#{{ section.title }}"><li>{{ section.title }}</li></a>
  {% endfor %}
  </ul>
</div>

{% for section in sections %}
<header>
  <h2><a name="{{ section.title }}">{{ section.title }}</a></h2>
  <p>{{ section.description }}</p>
</header>

{% for topic in section.topics %}
<article class="topic">
  <h2 style="color: {{ profile.color() }};">{{ topic.title }}</h2>
  {% if topic.subtitle %}
    <sub>{{ topic.subtitle }}</sub>
  {% endif %}
  <div class="content">
    <aside>
      {% if topic.stat %}
      <div class="topic-stats{% if topic.stat_stack %} stacked{% endif %}">
        {% for stat in topic.stat %}
          <div class="stat">
            <div class="stat-text">{{ stat.title }}</div>
            <div class="stat-value">{{ stat.value }}</div>
          </div>
        {% endfor %}
      </div>
      {% endif %}
      {% if topic.description %}
      <p>{{ topic.description }}</p>
      {% endif %}
      <sub>Data Source: Lorem Ipsum</sub>
    </aside>
    <div class="viz">
      {% for d in topic.viz.data %}
        {{ d.url }}<br>
      {% endfor %}
    </div>
  </div>
</article>
<script>builds.push({{ topic.viz.serialize()|safe }});</script>
{% endfor %}

{% endfor %}

{% endblock %}

{% block js %}

<script>

  // var app, build = 0;
  // builds.forEach(function(build, i){
  //   if (i === builds.length - 1 - 5 - 1) {
  //     var container = d3.selectAll(".viz")[0][i];
  //     console.log(d3.select(container.parentNode).select("h3").html());
  //     app = viz(build, container);
  //   }
  // });

  var titleHeight = d3.select("#title-bar").node().offsetHeight;
  scrollFunctions.push(function(y){
    var showNav = y > window.innerHeight - titleHeight;
    d3.select("#title-bar").classed("visible", showNav);
    d3.select("#profile-nav").classed("visible", showNav);
  })

</script>

{% endblock %}
