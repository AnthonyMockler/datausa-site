{% extends "templates/nav.html" %}

{% block body %}
<div class="home-container">
	<div class="bg">
		<div class="landing"></div>
		<div class="strip"></div>
	</div>

<div class="content">
	<article class="landing">
		<div class="home-logo">
			<img class="logo" src="/static/img/home/logo_p2.png" alt="DataUSA" />
		</div>
    <!-- <section class="home-desc"><h2>An open source </br>platform to explore </br>public U.S. data</h2></section> -->
		<section class="search-home-container">
			<a href="/search/" id="search-switch" class="adv" onclick="advSearch.toggle();">Advanced Search</a>
			<div class="search-input-btn">
				<input type="text" data-results="search-home" data-search="home" id="home-search-input" class="search-input" autofocus />
			</div>
			<div id="search-home" class="search-body">
        <div class="no-search-results">No results found</div>
				<div class="search-results"></div>
			</div>
      <section class="results-show-all">
        <a href="/search/">Show all results <span class="more"></span></a>
      </section>
		</section>
	</article>
</div>

</div>
{% endblock %}

{% block js %}

<script>

var bg_imgs = [1, 6];
var bg_img = "" + (Math.floor(Math.random() * bg_imgs[1]) + 1);
d3.select(".landing").style("background-image", "url('/static/img/home/bg/" + bg_img + ".jpg')");
localforage.setItem("homepage_image", bg_img);

var homeInput = d3.select("#home-search-input");
d3.select("#search-switch.adv").on("click", function(){
	d3.event.preventDefault();
	window.location = "/search/?q=" + homeInput.node().value;
});

d3.select("#home-search-input").on("input", function() {
  window.clearTimeout(tout);
  var inputText = document.getElementById("home-search-input").value;
  d3.select(".search-input-text").text(inputText);
});

d3.select("#home-search-input").on("keyup.clear_demo", function() {
  window.clearTimeout(tout);
	d3.event.preventDefault();
});

var search_input = d3.select("#home-search-input");
var current_search_term = search_input.property("value");
if(current_search_term){

  var results_div_id = search_input.attr("data-results");
  var results_div = d3.select("#"+results_div_id)
  results_div.classed("open", true);

  search.term = current_search_term;
  search.container = d3.select("#search-" + search_input.attr("data-search"));
  search.reload();

  search_input.node().focus();
}

var demo_input = document.getElementById('home-search-input');

var letter_index = 0;
var tout = 0;
var sterms = ["Boston", "Computer Science", "Civil Engineers", "Cook County", "Hospitals", "02139", "California", "Biology"]
var sterm_index = 0;
var type_this = sterms[sterm_index];
var ready = true;

window.next_letter = function() {
  var interval = 130;
  if (letter_index <= type_this.length) {
    search_input.property("value", type_this.substr(0, letter_index++));
    if(letter_index > type_this.length){
      interval = interval * 22;
      search_input.on("click")();
    }
  }
  else {
    letter_index = 0;
    d3.select(document).on("click")();
    search_input.node().focus();
    sterm_index = (sterm_index+1)%sterms.length;
    type_this = sterms[sterm_index];
  }
  tout = setTimeout("next_letter()", interval);
}

search_input.on("click.clear", function(){
  this.select();
  window.clearTimeout(tout);
})

next_letter();

</script>

{% endblock %}
