{% extends "templates/nav.html" %}

{% block body %}

<div class="bg">
  <div class="bg-filter"></div>
</div>
<div class="bound">
<div id="search-advanced">
  <div class="search-nav">
    <input class="search-input" data-search="advanced" type="text" placeholder="Search DataUSA&hellip;" autofocus />
  </div>
  
  <div class="search-helpers">
    <div class="search-suggestions">
    </div>
  </div>

  <div class="search-results-container">
    <div class="search-refine">
      <a href="#" class="clear"><span>&times;</span> Clear Refinements</a>
      
      <div class="geo" class="no-results">
        <h2><a href="#" data-filter="geo">Locations (<span class="num_res">0</span>)</a></h2>
        <ul>
          <li><a href="#" data-filter="geo" data-depth="040" class="no-results">States (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-filter="geo" data-depth="050" class="no-results">Counties (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-filter="geo" data-depth="310" class="no-results">MSAs (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-filter="geo" data-depth="160" class="no-results">Places (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-filter="geo" data-depth="795" class="no-results">PUMAs (<span class="num_res">88</span>)</a></li>
        </ul>
      </div>
      
      <div class="naics" class="no-results">
        <h2><a href="#" data-filter="naics">Industries (<span class="num_res">0</span>)</a></h2>
        <ul>
          <li><a href="#" data-depth="0" class="no-results">Top Level (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-depth="1" class="no-results">2 digit (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-depth="2" class="no-results">3 digit (<span class="num_res">88</span>)</a></li>
        </ul>
      </div>
      
      <div class="soc" class="no-results">
        <h2><a href="#" data-filter="soc">Occupations (<span class="num_res">0</span>)</a></h2>
        <ul>
          <li><a href="#" data-depth="0" class="no-results">Top Level (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-depth="1" class="no-results">2 digit (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-depth="2" class="no-results">3 digit (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-depth="3" class="no-results">4 digit (<span class="num_res">88</span>)</a></li>
        </ul>
      </div>
      
      <div class="cip" class="no-results">
        <h2><a href="#" data-filter="cip">College Majors (<span class="num_res">0</span>)</a></h2>
        <ul>
          <li><a href="#" data-depth="0" class="no-results">2 digit (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-depth="1" class="no-results">4 digit (<span class="num_res">88</span>)</a></li>
          <li><a href="#" data-depth="2" class="no-results">6 digit (<span class="num_res">88</span>)</a></li>
        </ul>
      </div>
      
    </div>

    <div class="search-results-dynamic">
      <div class="search-autocorrected">
        No results found. Showing results for <span class="result"></span> instead.
      </div>
      <div class="search-results">
        <div class="search-item">
          <div class="thumb" style="background: url('/static/img/thumb/geo/01000US.jpg');"></div>
          <div class="info">
            <h2>United States of America</h2>
            <p class="subttile">Nation</p>
          </div>
          <div class="profile">
            <a href="#">View Profile &raquo;</a>
          </div>
        </div>
        <div class="search-item">
          <div class="thumb" style="background: url('/static/img/thumb/geo/01000US.jpg');"></div>
          <div class="info">
            <h2>Indiana</h2>
            <p class="subttile">State</p>
          </div>
          <div class="profile">
            <a href="#">View Profile &raquo;</a>
          </div>
        </div>
        <div class="search-item active">
          <div class="thumb" style="background: url('/static/img/thumb/geo/01000US.jpg');"></div>
          <div class="info">
            <h2>Economy, IN</h2>
            <p class="subttile">Census Designated Place</p>
            <p class="bcrumb">
              <a href="/profile/geo/01000US/">United States</a> / <a href="/profile/geo/04000US18/">Indiana</a> / <a href="/profile/geo/05000US18177/">Wayne County</a> / <a href="/profile/geo/31000US39980/">Richmond, IN</a> / <a href="/profile/geo/79500US1802600/">Wayne, Fayette, Rush &amp; Union Counties PUMA</a>
            </p>
            <div class="details-anchors"><ul><li><h3><a href="/profile/geo/16000US1820152/#economy">Economy</a></h3><p>Here we present trends in jobs, wages, industries and family structures over time in Economy, IN.</p></li><li><h3><a href="/profile/geo/16000US1820152/#demographics">Demographics</a></h3><p>The American Community Survey collects information on the demographics and origins of the residents in Economy, IN.</p></li><li><h3><a href="/profile/geo/16000US1820152/#education">Education</a></h3><p>The Census Bureau collects a large amount of data regarding higher education.</p></li><li><h3><a href="/profile/geo/16000US1820152/#housing">Housing &amp; Living</a></h3><p>The American Census Survey contains a lot of rich information pertaining to households and the people that reside in them.</p></li><li><h3><a href="/profile/geo/16000US1820152/#health">Health &amp; Safety</a></h3><p>The University of Wiconsin has collected data on various health and safety factors, and created a ranking for each.</p></li></ul></div>
          </div>
          <div class="profile">
            <a href="#">View Profile &raquo;</a>
          </div>
        </div>
        <div class="search-item">
          <div class="thumb" style="background: url('/static/img/thumb/geo/01000US.jpg');"></div>
          <div class="info">
            <h2>Wayne, Fayette, Rush &amp; Union Counties</h2>
            <p class="subttile">Public Use Micro Area</p>
          </div>
          <div class="profile">
            <a href="#">View Profile &raquo;</a>
          </div>
        </div>
      </div>
    </div>
    <!-- <div class="search-details">
      <h2 class="details-title">&mdash;</h2>
      <div class="details-sumlevels"></div>
      <div class="details-sumlevels-results"></div>
      <div class="details-anchors"></div>
      <a href="#" class="details-profile">Go to Profile &gt;</a>
    </div> -->
  </div>
</div>
    <!-- <div class="search-filters" tabindex="1">
      <a class="search-filters-toggle">
        <span class="search-filters-toggle-label">All</span>
        <span class="search-filters-toggle-icon"></span>
      </a>
      <div class="search-filters-options" style="top: 65px;">
        <ul class="search-filters-options-inner">
          <li><a href="#" class="search-filter active" data-filter="">All</a></li>
          <li><a href="#" class="search-filter" data-filter="geo">Locations</a></li>
          <li><a href="#" class="search-filter" data-filter="naics">Industries</a></li>
          <li><a href="#" class="search-filter" data-filter="soc">Occupations</a></li>
          <li><a href="#" class="search-filter" data-filter="cip">College Majors</a></li>
        </ul>
      </div>
    </div> -->

    <!--   <div class="search-nestings">
    <div class="search-nestings-geo">
      <a href="#" data-depth="">All</a>
      <a href="#" data-depth="0">States</a>
      <a href="#" data-depth="1">Counties</a>
      <a href="#" data-depth="2">MSAs</a>
      <a href="#" data-depth="3">Places</a>
      <a href="#" data-depth="5">PUMAs</a>
    </div>
    <div class="search-nestings-naics">
      <a href="#" data-depth="">All</a>
      <a href="#" data-depth="0">Top Level</a>
      <a href="#" data-depth="1">2 digit</a>
      <a href="#" data-depth="2">3 digit</a>
    </div>
    <div class="search-nestings-soc">
      <a href="#" data-depth="">All</a>
      <a href="#" data-depth="0">Top Level</a>
      <a href="#" data-depth="1">2 digit</a>
      <a href="#" data-depth="2">3 digit</a>
      <a href="#" data-depth="3">4 digit</a>
    </div>
    <div class="search-nestings-cip">
      <a href="#" data-depth="">All</a>
      <a href="#" data-depth="0">2 digit</a>
      <a href="#" data-depth="1">4 digit</a>
      <a href="#" data-depth="2">6 digit</a>
    </div>
  </div> -->
</div>
{% endblock %}

{% block js %}
<script>
  search.anchors = {{anchors|safe}};
  
  d3.selectAll(".search-refine a").on("click", function(){
    d3.select(".search-refine a.clear").style("display", "block");
    if(d3.select(this).classed("clear")){
      d3.select(this).style("display", "none")
    }
    d3.selectAll(".search-refine a").classed("active", false);
    d3.select(this).classed("active", true);
    var filter = d3.select(this).attr("data-filter");
    var depth = d3.select(this).attr("data-depth");
    search.type = filter;
    search.depth = depth;
    search.reload();
  })

  /*
   * Constrain search to specific types of attrs
   */
  d3.selectAll(".search-filter").on("click", function(){
    
    // set constrained search mode
    search.type = d3.select(this).attr("data-filter");
    
    // close inner dropdown and set title
    d3.select(".search-filters-options").style("opacity", 0).style("display", "none");
    d3.select(".search-filters-toggle-label").text(d3.select(this).text())
    
    // set active link for profile type
    d3.selectAll(".search-filters-options-inner a").classed("active", false)
    d3.select(this).classed("active", true)

    // show appropriate nesting levels
    d3.selectAll(".search-nestings > div").style("display", "none")
    d3.select(".search-nestings-"+search.type).style("display", "block")
    
    // activate first nesting level if no levels been selected previously
    if(search.type){
      var active_nesting = d3.selectAll(".search-nestings-"+search.type+" a").filter(function(){
        return d3.select(this).classed("active")
      })
      active_nesting = active_nesting.size() ? active_nesting : d3.select(".search-nestings-"+search.type+" a");
      active_nesting.on("click")(active_nesting.node())
    }
    else {
      search.reload();
    }
    
    // prevent default anchor link behavior
    d3.event.preventDefault();
  })
  
  /*
   * Constrain search to specific nesting/sumlevel of attrs
   */
  d3.selectAll(".search-nestings a").on("click", function(active_el){
    var _this = active_el || this;
    var depth = d3.select(_this).attr("data-depth");
    
    // set constrained search mode with appropriate sumlevel
    // search.term = "";
    if(depth){
      search.current_depth[search.type] = d3.select(_this).attr("data-depth");
    }
    search.reload();
    
    // set active link for profile type
    d3.select(_this.parentNode).selectAll("a").classed("active", false)
    d3.select(_this).classed("active", true)
    
    // prevent default anchor link behavior
    d3.event.preventDefault();
  })
  
  d3.select(".search-filters-toggle").on("click", function(){
    var current_opacity = parseInt(d3.select(".search-filters-options").style("opacity"));
    var current_display = d3.select(".search-filters-options").style("display");
    d3.select(".search-filters-options")
      .style("opacity", (current_opacity+1)%2)
      .style("display", current_display=="block"?"none":"block")
    d3.event.stopPropagation();
  })

  var term = location.search ? location.search.split("=")[1] : "";
  search.term = term.replace(/%20/g, " ");
  search.advanced = true;
  search.container = d3.select("#search-advanced");

  var input = d3.selectAll(".search-input").attr("value", search.term);
  if (input.node().setSelectionRange !== undefined) {
    input.node().setSelectionRange(search.term.length, search.term.length);
  }

  search.reload();
  
  d3.select(document).on("click", function(){
    d3.select(".search-filters-options").style("opacity", 0).style("display", "none");
  })

</script>
{% endblock %}
